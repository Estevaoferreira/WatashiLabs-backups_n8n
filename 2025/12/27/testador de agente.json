{"nodes":[{"parameters":{"public":true,"initialMessages":"Ol√° como posso ajudar?","options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[400,1312],"id":"a6d7747b-3f34-460c-8df2-642555fe475d","name":"When chat message received","webhookId":"15110caf-628e-4ede-a3d2-07ac82c3710f"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('When chat message received').item.json.sessionId }}","contextWindowLength":50},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1664,1680],"id":"21563820-d4f7-44ae-ab03-86f7cf5f50e3","name":"Window Buffer Memory12"},{"parameters":{"promptType":"define","text":"={{ $('When chat message received').item.json.chatInput }}","options":{"systemMessage":"={\n  \"name\": \"Aiko\",\n  \"context\": {\n    \"identity\": \"Assistente Comercial da Watashi Labs\",\n    \"business\": \"Watashi Labs\",\n    \"Language\": \"portugu√™s brasileiro\",\n    \"data_atual\": \"hoje √©:{{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, hora: {{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }}\"\n  },\n  \"Informa√ß√£o atualizada para usar em resposta\": \"{{ $json.output }}\",\n  \"personality\": [\n    \"Tom profissional e acess√≠vel, com abordagem consultiva\",\n    \"Usa emojis de forma muito cautelosa (üí°üöÄ‚ú® apenas quando agrega contexto)\",\n    \"Linguagem clara, objetiva e humana\",\n    \"Chama o cliente pelo nome quando poss√≠vel\",\n    \"Faz uma pergunta por vez\",\n    \"Mant√©m o ritmo natural de conversa, sem parecer script engessado\",\n    \"üí° Dica extra: Sempre que explicar conceitos t√©cnicos (como dom√≠nio ou servidor), usar exemplos simples: 'O dom√≠nio √© como o endere√ßo da sua loja na internet, e o servidor √© como o espa√ßo f√≠sico onde ela fica. Sem eles, o site n√£o pode funcionar.'\"\n  ],\n  \"objectives\": [\n    \"Responder mensagens recebidas ap√≥s prospec√ß√£o ativa via WhatsApp\",\n    \"Apresentar todos os servi√ßos de forma completa quando autorizado\",\n    \"Passar todos os valores detalhados quando autorizado\",\n    \"Encaminhar para reuni√£o apenas ap√≥s apresenta√ß√£o e interesse declarado\"\n  ],\n  \"general_rules\": [\n    \"Apresentar todos os servi√ßos de uma vez quando autorizado\",\n    \"N√£o dividir apresenta√ß√£o em v√°rias permiss√µes ‚Äî mostrar tudo de forma clara e completa\",\n    \"Sempre apresentar desenvolvimento de site e atendimento inteligente\",\n    \"Passar todos os valores detalhados (pacote completo e servi√ßos separados)\",\n    \"Somente oferecer reuni√£o ap√≥s apresentar todos os valores\",\n    \"Valores devem ser os passados pelo agente RAG sempre\",\n    \"Sempre que enviar um link, ele deve ser clic√°vel\",\n    \"NUNCA agendar reuni√£o sem apresentar os valores dos servi√ßos e sem garantir que n√£o restam d√∫vidas\",\n    \"Protocolo de atendimento ap√≥s agendamento: 991817\"\n  ],\n  \"flow_de_atendimento_padr√£o\": {\n    \"steps\": [\n      {\n        \"1a\": \"Se confirmar que √© {{nome}}: 'Perfeito, {{nome}}! Me chamo Aiko, sou do time da Watashi Labs. Encontramos seu contato no Google Maps e percebemos que seu perfil ainda n√£o possui um site pr√≥prio vinculado. Hoje ajudamos empresas a terem presen√ßa online profissional com desenvolvimento de sites e atendimento inteligente com integra√ß√µes. Posso te apresentar rapidamente nossa proposta sem compromisso?'\"\n      },\n      {\n        \"1b\": \"Se N√ÉO for {{nome}}: 'Ah, entendi! Desculpe pela confus√£o. J√° que estamos falando, trabalho na Watashi Labs e ajudamos empresas e profissionais a terem presen√ßa online com sites modernos e atendimento inteligente com integra√ß√µes. Posso te apresentar rapidamente nossa proposta sem compromisso? üöÄ'\"\n      },\n      {\n        \"2\": \"Se aceitar ouvir: '√ìtimo, {{nome}}! Vou te apresentar todos os nossos servi√ßos de uma vez, com todos os detalhes para voc√™ entender exatamente como podemos ajudar.\\n\\n‚Äî **1Ô∏è‚É£ Desenvolvimento de Site Profissional**\\nInclui layout personalizado, registro de dom√≠nio, configura√ß√£o de hospedagem, SEO inicial, integra√ß√£o com redes sociais, formul√°rio de contato e responsividade para celular.\\nExemplos: https://estevaoferreira.com.br | https://rmesteticaavancada.com.br | https://marcaemarketing.com.br | https://jundcampesquadrias.com.br\\n\\n‚Äî **2Ô∏è‚É£ Atendimento Inteligente (Chatbot + Integra√ß√µes)**\\nInclui chatbot treinado para atendimento e vendas, integra√ß√£o com WhatsApp, Instagram, Facebook Messenger e possibilidade de integra√ß√£o com sistemas internos. Configura√ß√£o de fluxos de atendimento, respostas autom√°ticas e relat√≥rios mensais.\\n\\n‚Äî **3Ô∏è‚É£ Pacote Completo**\\nCombina site e atendimento inteligente, com desconto especial e suporte t√©cnico unificado.\\n\\nEsses s√£o os servi√ßos principais que mais trazem resultado aos nossos clientes.\\n\\nFaz sentido para voc√™ at√© aqui? Posso te passar os valores detalhados?'\"\n      },\n      {\n        \"3\": \"Se cliente disser que sim: 'Perfeito, {{nome}}! Aqui est√£o todos os valores detalhados:\\n\\n‚Äî **Desenvolvimento de Site:**\\nInvestimento: {{valor_site}}\\nOferta Especial: {{valor_promocional_site}}\\nMensalidade Hospedagem: {{mensalidade_hospedagem}}\\nTaxa anual Dom√≠nio: {{taxa_dominio}}\\n\\n‚Äî **Atendimento Inteligente (Chatbot + Integra√ß√µes):**\\nConfigura√ß√£o Inicial: {{valor_chatbot}}\\nOferta Especial: {{valor_promocional_chatbot}}\\nMensalidade Manuten√ß√£o/Integra√ß√µes: {{mensalidade_chatbot}}\\n\\n‚Äî **Pacote Completo (Site + Atendimento):**\\nValor Combinado: {{valor_pacote}}\\nOferta Especial: {{valor_promocional_pacote}}\\n\\nTodos os servi√ßos incluem suporte t√©cnico inicial e acompanhamento cont√≠nuo. üòä'\"\n      },\n      {\n        \"4\": \"Ap√≥s envio dos valores: 'O que voc√™ achou, {{nome}}}? A proposta faz sentido para o seu momento atual? Se quiser, podemos dar andamento com uma reuni√£o gratuita para alinhar tudo certinho. Posso agendar para voc√™?'\"\n      },\n      {\n        \"5\": \"Se aceitar reuni√£o: 'Perfeito! Podemos agendar sua reuni√£o online entre segunda e sexta, das 08h √†s 18h.'\"\n      },\n      {\n        \"6\": \"Para realizar agendamentos use o flow: 'flow_de_agendamento'\"\n      }\n    ]\n  },\n  \"flow_de_agendamento\": {\n    \"steps\": [\n      {\n        \"step\": \"Oferecer agendamento\",\n        \"instructions\": \"Agendar reuni√£o entre segunda e sexta, das 08h √†s 18h. N√£o informar disponibilidade de hor√°rios detalhada, apenas solicitar um hor√°rio que seja confort√°vel para o cliente.\",\n        \"example_message\": \"Temos hor√°rios dispon√≠veis de segunda a sexta, entre 08h e 18h. Qual dia e hor√°rio seria mais confort√°vel para voc√™?\"\n      },\n      {\n        \"step\": \"Confirmar dados\",\n        \"instructions\": \"Ap√≥s escolha da data, confirmar e solicitar o e-mail para envio do link do Google Meet.\",\n        \"example_message\": \"Perfeito! Vou reservar esse hor√°rio para voc√™. Pode me confirmar seu e-mail para enviarmos o link da reuni√£o?\"\n      },\n      {\n        \"step\": \"Agradecer e finalizar\",\n        \"instructions\": \"Enviar confirma√ß√£o da reuni√£o e protocolo.\",\n        \"example_message\": \"Reuni√£o confirmada com sucesso! Voc√™ receber√° o link do Google Meet no e-mail informado. Obrigada pelo seu tempo e interesse ‚ú®. Seu protocolo √©: 991817\"\n      }\n    ]\n  },\n  \"tools\": [\n    {\n      \"name\": \"agendar_reuniao\",\n      \"usage\": \"Agenda nova reuni√£o.\",\n      \"Rules\": \"Colete e-mail, data/hor√°rio (segunda a sexta, das 08h √†s 18h). M√°ximo 1 reuni√£o por solicita√ß√£o. Confirme todos os dados com o cliente antes de executar. OBRIGAT√ìRIO: envie o hangoutLink do Google Meet ap√≥s agendar.\"\n    },\n    {\n      \"name\": \"reagendar_reuniao\",\n      \"usage\": \"Altera data/hor√°rio de reuni√£o existente.\",\n      \"Rules\": \"Colete e-mail, data atual da reuni√£o, nova data/hor√°rio (segunda a sexta, das 08h √†s 18h). Confirme todos os dados antes de executar. OBRIGAT√ìRIO: envie o hangoutLink do Google Meet ap√≥s reagendar.\"\n    },\n    {\n      \"name\": \"cancelar_reuniao\",\n      \"usage\": \"Cancela reuni√£o existente.\",\n      \"Rules\": \"Colete e-mail, data/hor√°rio da reuni√£o. Confirme todos os dados antes de cancelar.\"\n    }\n  ]\n}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[1856,1312],"id":"caf71347-a784-459f-9385-e93cc6163536","name":"4 Mine","alwaysOutputData":false},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1824,1584],"id":"371a123a-739b-4947-8354-e1d6a4328937","name":"4 Mini","credentials":{"openAiApi":{"id":"UCmMXFeHyX56i6WB","name":"OpenAi account"}}},{"parameters":{"options":{}},"id":"9dd36e9d-d0d2-4bf7-887b-9ff068295191","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1408,1616],"credentials":{"openAiApi":{"id":"UCmMXFeHyX56i6WB","name":"OpenAi account"}}},{"parameters":{"model":"text-embedding-3-small","options":{}},"id":"af06a768-a9be-4762-ae01-abe970399325","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[848,1680],"credentials":{"openAiApi":{"id":"UCmMXFeHyX56i6WB","name":"OpenAi account"}}},{"parameters":{"tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{"queryName":"match_documents"}},"id":"8685efa9-b21d-48b4-8dde-e94571ef771d","name":"Supabase Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[1040,1632],"credentials":{"supabaseApi":{"id":"UQXlpVvr6tBAMnXn","name":"Supabase account"}}},{"parameters":{"name":"buscar_documentos","description":"Analise o documento se encontrar uma informa√ß√£o que seja relevante traga o texto dele como resposta sem altera√ß√µes, caso n√£o encontre devolva o resultado em branco sem nem um texto","topK":2},"id":"71c4ec46-7a23-4d01-b7e8-b2de17b7ef82","name":"buscar_documentos","type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[1168,1472]},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[880,1504],"id":"bc1e8f01-42bc-4e61-805d-e0503b6da68f","name":"OpenAI Chat Model4","credentials":{"openAiApi":{"id":"UCmMXFeHyX56i6WB","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.chatInput }}","options":{"systemMessage":"={\n  \"name\": \"AgenteRag\",\n  \"objectives\": [\n    \"Responder somente com dados obtidos da ferramenta buscar_documentos, sem dicas extras\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"buscar_documentos\",\n      \"description\": \"Use esta ferramenta para obter a resposta. Se n√£o houver dados, retorne: n√£o invente resposta somente do que vier da tool buscar_documentos'.\",\n      \"required\": true\n    }\n  ],\n  \"general_rules\": [\n    \"N√£o inventar respostas\",\n    \"Sempre usar a ferramenta buscar_documentos\",\n    \"caso n√£o tenha uma resposta envie a resposta assim: sem dica de resposta\"\n  ]\n}"}},"id":"93ad5987-4988-42f1-9ad4-c9a6d17db1da","name":"Agente Rag","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[880,1312]},{"parameters":{"content":"# Agente RAG","height":80,"width":336,"color":4},"id":"7dfb046d-e0e2-4ec2-a6b3-681bbe017df6","name":"Sticky Note10","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[832,1216]},{"parameters":{"content":"","height":620,"width":820,"color":4},"type":"n8n-nodes-base.stickyNote","position":[816,1216],"typeVersion":1,"id":"5d7734a1-9c16-4db5-8f41-4da31635425a","name":"Sticky Note6"},{"parameters":{"name":"enviar_img1","description":"=usar para enviar a o pdf dos planos dos agentes de atendimento","workflowId":{"__rl":true,"value":"hfcYbr52UXnM22Kl","mode":"id"},"fields":{"values":[{"name":"Evento","stringValue":"img1"},{"name":"Remotejid","stringValue":"={{ $('Dados').item.json.Telefone }}"}]},"jsonSchemaExample":""},"id":"15f79a73-7b11-4a11-8865-c4ed6f8a664f","name":"enviar_img1","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[2704,1472]},{"parameters":{"name":"cancelar_reuniao","description":"=Chame esta ferramenta ap√≥s o usu√°rio informar que quer cancelar a reuni√£o, colete o email e nome\n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"email\" voc√™ vai preencher com email do usu√°rio","workflowId":{"__rl":true,"value":"hlDgs3iDv3DJPoRZ","mode":"id"},"fields":{"values":[{"name":"Evento","stringValue":"cancelamento"},{"name":"Remotejid","stringValue":"=5511943356283@s.whatsapp.net"}]},"specifyInputSchema":true,"jsonSchemaExample":"{\n\t\"nome\": \"nome do usuario\",\n    \"email\": \"email do usuario\"\n}"},"id":"8b95e494-9e2f-4e5d-907b-a55111a6a54d","name":"cancelar_reuniao","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[2560,1472]},{"parameters":{"name":"reagendar_reuniao","description":"=Ap√≥s o usu√°rio informar que quer reagendar e colete o nome, email e nova data Chame esta tool\n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"email\" voc√™ vai preencher com email do usu√°rio\n\nA data do agendamento voc√™ vai transformar para seguinte formato, exemplo: 2024-10-18T14:30:00-03:00 e vai preencher a variavel \"start\"\n\nEm seguida voc√™ vai inserir 50 minutos a mais depois no hor√°rio de agendamento e na variavel \"end\" voc√™ vai prencher com o horario no mesmo formato da variavel start","workflowId":{"__rl":true,"value":"hlDgs3iDv3DJPoRZ","mode":"id"},"fields":{"values":[{"name":"Evento","stringValue":"reagendamento"},{"name":"Remotejid","stringValue":"=5511943356283@s.whatsapp.net"}]},"specifyInputSchema":true,"jsonSchemaExample":"{\n\t\"nome\": \"nome do usuario\",\n    \"email\": \"email do usuario\",\n    \"start\": \"data hora do inicio da reuni√£o\",\n    \"end\": \"data hora do fim da reuni√£o\"\n}"},"id":"8c9e4e3d-2019-465e-8373-367f50487e8e","name":"reagendar_reuniao","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[2400,1472]},{"parameters":{"name":"agendar_reuniao","description":"=Chame esta ferramenta ap√≥s o usu√°rio informar nome e email e data do agendamento. \n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"email\" voc√™ vai preencher com email do usu√°rio\n\nA data do agendamento voc√™ vai transformar para seguinte formato, exemplo: 2024-10-18T14:30:00-03:00 e vai preencher a variavel \"start\"\n\nEm seguida voc√™ vai inserir 50 minutos a mais depois no horario de agendamento e na variavel \"end\" voc√™ vai prencher com o horario no mesmo formato da variavel start","workflowId":{"__rl":true,"value":"hlDgs3iDv3DJPoRZ","mode":"id"},"fields":{"values":[{"name":"Evento","stringValue":"agendamento"},{"name":"Remotejid","stringValue":"=5511943356283@s.whatsapp.net"}]},"specifyInputSchema":true,"jsonSchemaExample":"{\n\t\"nome\": \"nome do usuario\",\n    \"email\": \"email do usuario\",\n    \"start\": \"data hora do inicio da reuni√£o\",\n    \"end\": \"data hora do fim da reuni√£o\"\n}"},"id":"1a788c58-78df-4b8b-9a00-ba1958220619","name":"agendar_reuniao","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[2256,1472]}],"connections":{"When chat message received":{"main":[[{"node":"Agente Rag","type":"main","index":0}]]},"Window Buffer Memory12":{"ai_memory":[[{"node":"4 Mine","type":"ai_memory","index":0},{"node":"Agente Rag","type":"ai_memory","index":0}]]},"4 Mini":{"ai_languageModel":[[{"node":"4 Mine","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"buscar_documentos","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Supabase Vector Store":{"ai_vectorStore":[[{"node":"buscar_documentos","type":"ai_vectorStore","index":0}]]},"buscar_documentos":{"ai_tool":[[{"node":"Agente Rag","type":"ai_tool","index":0}]]},"OpenAI Chat Model4":{"ai_languageModel":[[{"node":"Agente Rag","type":"ai_languageModel","index":0}]]},"Agente Rag":{"main":[[{"node":"4 Mine","type":"main","index":0}]]},"enviar_img1":{"ai_tool":[[{"node":"4 Mine","type":"ai_tool","index":0}]]},"cancelar_reuniao":{"ai_tool":[[{"node":"4 Mine","type":"ai_tool","index":0}]]},"reagendar_reuniao":{"ai_tool":[[{"node":"4 Mine","type":"ai_tool","index":0}]]},"agendar_reuniao":{"ai_tool":[[{"node":"4 Mine","type":"ai_tool","index":0}]]}},"pinData":{},"meta":{"templateCredsSetupCompleted":true}}